"use client";

import { getSupabaseFileUrlFromRelativePath } from "@/services/supabase/storage";
import { LoadingIcon } from "../ui/LoadingIcon";

function checkPictureIsNotEmpty(url: string) {
  const DEFAULT_URL = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAGQCAYAAACAvzbMAAAAAXNSR0IArs4c6QAAGk1JREFUeF7t3WeP48bSBlA5e51zztnw//8X/mo455xzThc1eLmg+9WIVM1oS7V7BFwYuKNmt0718iGbEnnVyy+//O/GiwABAgQI7ClwlQDZU8zbCRAgQOBEQICYCAQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQICYAwQIECCQEhAgKTaNCBAgQECAmAMECBAgkBIQICk2jQgQIEBAgJgDBAgQIJASECApNo0IECBAQIBcgXPgmWee2dx+++0nn/zPP//cvPvuu5sff/xxtcTdd9+9ueeeezYXLlzYXHPNNRfb/f3335uff/558+WXX26+++671dub3njzzTdv7rvvvs2tt966ufbaazdXXXXVyZ/++eefze+//7755ptvTrYd/VxJr3B58sknNzfccMPJx45avfHGG3sR3H///ZuoW2zj6quvPmn777//nljG9sJ1nzkwdX6oubDXh/PmMgEBUkZf0/FDDz20iZ3JtBPZJ0Cuv/76zWOPPba57bbbLu7ct32K2DH98MMPmw8++GDzxx9/rPqgMa4Ij3kgbWsYQfLRRx+lAmrVQI7wTc8+++yJ+fTaJ0AifB599NFN/HfXK0I6Ajps1wT0IefCEZbAkE4RECBX0NSII/snnnhiE//4p9faALnxxhs3jz/++OaWW25ZLfbTTz9t3n///c1vv/22s02EUhzJTqG21EGMOXZ0scO73F9j4O9zBhL1Dtuo3ZpXBH+cOUbNdoXIIefCmnF6z/EICJDjqcVBRxJH9k899dR/jmSjw7UBEsFz1113/WdZ6fvvv7+49BFLYrGsFf+dlp5ihxQ7+ffee+/Uz3bvvfduHn744f+cefzyyy+bL7744mRndt11151sNwImlrWm16+//rp55513FsPpoKgH3nhYRgDMA39tgGyrd4RC1OPrr78+WWqMeoZ/nJ3MlwvD/uOPPz710x1qLhyY0+YPICBADoB6jJuMnXQsEY1H+WsCJHbgjzzyyMWdfOyIYgcT6+bj64EHHtjE/6alqL/++mvz4Ycfbj1biCPZCLW4lhKvXYEzHk3He7/66quTZbLL8XVa4K8NkDhziTpMwRBLiWEVoT++xjPAWCaM62IRMuPrUHPhcqzhlfCZBMgVUOU4ko3lpziaH19rAmR+0X3Njjt2SLGjmXZesdN66623tobNgw8+eDHU4swjLg6ftnwSR8yxnj+dieza0XUvawR+XKuaDOefZ+kaSITPc889t7nppptOmsX1jU8//XTz2WefncqytsZr3zd1tHYudK/XlTp+AXKZVz52JvGPfrp2EUeiEQLTN3qWAiSO/OMbQFP4LL0/OGNJJM4spqWX6DOWm8Yj2tjJxfans4/YwX3yySc7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`;
  if (url === "") return DEFAULT_URL;

  return getSupabaseFileUrlFromRelativePath(url ?? "", "avatars");
}

type Props = {
  profilePictureUrl: string;
  isUploadingProfile: boolean;
};

export function ProfileAvatar({
  profilePictureUrl,
  isUploadingProfile,
}: Props) {
  return (
    <div className="z-50 relative mt-16">
      <img
        className="rounded-full w-36 h-36 border-white border-4"
        alt="User Avatar"
        src={checkPictureIsNotEmpty(profilePictureUrl)}
      />
      {isUploadingProfile ? (
        <div className="z-[100] text-white absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
          <LoadingIcon />
        </div>
      ) : null}
    </div>
  );
}
